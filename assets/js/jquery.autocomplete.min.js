/**
 * Created by zfd on 2017/8/8.
 */
var con = $('<div class="autocomplete"></div>');
var tit = $('<div class="tit"></div>');
var ul = $('<ul class="datalist"></ul>');
//var s = $('<style>.autocomplete{position:absolute;border:1px solid #0376d6;background:#fff;overflow:hidden;max-width:250px;z-index:99999}.autocomplete ul{padding:0;margin:0;display:block;padding:5px}.autocomplete ul li{height:28px;line-height:28px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;padding:0 5px}.autocomplete ul li a{color:#676a6c;text-decoration:none;font-size:14px;display:block}.autocomplete ul li:hover{background:#0376d6;color:#fff}.autocomplete ul li:hover a{color:#fff}.autocomplete .tit{border-bottom:1px solid #ccc;padding:5px}.autocomplete img{vertical-align: middle;margin-right: 5px;}</style>')
var s = $('<style>.autocomplete{position:absolute;border:1px solid #eaecef;background:#fff;overflow:hidden;max-width:250px;z-index:999999;width:100%;box-shadow: 2px 2px 3px #999}.autocomplete ul{padding:0;margin:0;display:block;padding:5px}.autocomplete ul li{height:35px;line-height:35px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;padding:0 5px}.autocomplete ul li a{color:#676a6c;text-decoration:none;font-size:14px;display:block}.autocomplete ul li:hover{background:#3499da;color:#fff}.autocomplete ul li:hover a{color:#fff}.autocomplete .tit{border-bottom:1px solid #eaecef;padding:5px;font-size: 14px;font-family: "Microsoft YaHei",sans-serif;background: #f1f1f1;line-height: normal!important}.autocomplete ul li a img{margin-right: 5px;vertical-align: -2px;}</style>');
var $li = $('<li><a href=""><img src="" alt=""></a></li>');
$('head').append(s);
function autoComplete(a) {
    a.keyup(function () {
        var q = a.val();
        var url = apiHost+'search/relatedword?q=' + q + '&limit=12';
        var ul1 = ul.clone();
        var ul2 = ul.clone();
        var position = a.offset();
        var h = a.height() + parseInt(position.top) + parseInt(a.css('padding-top')) + parseInt(a.css('padding-bottom')) + 4;
        var w = a.css('width');
        var connew = con.clone();
        $.ajax({
            url: url,
            type: 'GET',
            success: function (data) {
                if (data.length != 0) {
                    for (var i = 0; i < data.length; i++) {
                        var cell = $li.clone();
                        var str = data[i].split('#');
                        if (str[0] == '0') {//货币
                            var img = '';
                            if (str[3]) {//是否有小图
                                img = '<img src="' + str[3] + '">'
                            }
                            cell.find('a').attr('href', '/currencies/' + str[1]).attr('title', str[1]).html(img + str[2]);
                            ul1.append(cell);
                        }
                        else {//市场
                            var cell = $li.clone();
                            var img = '';
                            if (str[3]) {//是否有小图
                                img = '<img src="' + str[3] + '">'
                            }
                            cell.find('a').attr('href', '/exchange/' + str[1]).attr('title', str[1]).html(img + str[2]);
                            ul2.append(cell);
                        }
                    }
                    if (ul1.find('li').length != 0) {
                        tit.clone().text('货币').appendTo(connew);
                        ul1.appendTo(connew);
                    }
                    if (ul2.find('li').length != 0) {
                        tit.clone().text('交易平台').appendTo(connew);
                        ul2.appendTo(connew);
                    }
                    $('body').find('.autocomplete').remove();
                    connew.css('left', position.left).css('top', h).css('min-width', w)
                    $('body').append(connew);
                } else {
                    $('body').find('.autocomplete').css('display', 'none');
                }
                /*  a.blur(function(){
                      $('body').find('.autocomplete').css('display','none');
                  })*/
                $('body').click(function () {
                    $('body').find('.autocomplete').css('display', 'none');
                })
                $('body').find('.autocomplete').find('a').click(function (e) {
                    e.stopPropagation();
                    a.val($(this).text());
                    $('body').find('.autocomplete').css('display', 'none');
                })
            },
            error: function () {
                return false
            }
        })
    })
}
